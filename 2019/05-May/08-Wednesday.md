## 计划任务

- [x] CRM v1.17 任务：路由权限改造实现

  已完成，不过过程很心酸。  
  之前菜单的生成时通过 vuex getters，监听 roles 更新菜单。但这明显不合理，应该是获取到用户信息后再去生成菜单。  
  之前的权限判定模式不能满足现有需求，要新增流量兼职助教权限判定模式，并考虑未来可能还有其它特殊奇葩权限要求。目前已实现，但代码设计还是感觉有些别扭。
  以为搞定了的时候，晚上又发现菜单显示正常，但部门链接点击跳转到 401 页面。因为路由跳转的权限判定逻辑没有考虑到 auths 为 undefined 的情况。
  另外菜单高亮也发现一个很奇怪的问题，需要点击两次菜单才能高亮...后来查看 element-ui menu 源码发现其实是 defaultActive prop 值有问题。所有 menu-item 组件配置的 index prop 是 `route.name || route.path`，但 defaultActive 则是 route.path，很尴尬...

- [ ] 帮助 @三炮 梳理工单 v1.20 退款出纳列表页面代码

  三个路由共用一个页面，现在业务稍微麻烦的情况下，代码已经很乱，梳理的目的是进行拆分优化实践。
  没抽出时间

## 临时任务

- [x] 修复线上问题：退款单打回后修改退款渠道导致的业务问题

  用户申请退款，天猫会对信誉好的用户自动退款，而因为业务人员将退款单修改成银行卡退回，财务审核无法确定退款渠道的正确性，审核通过后出纳会直接打款出去，导致用户收到两笔退款。  
  这个问题涉及到的流程和状态，业务关系比较复杂，目前先临时处理，针对这种场景的退款单修改，不允许修改渠道。

- [x] 解决部门级联组件不提供 options prop 情况下数据不显示问题

  已解决，自己代码写的有问题，然后优化了代码结构。
